## Nginx - Enabling PUT
When allowing `HTTP` uploads, it is critical to be 100% positive that users cannot upload web shells and execute them. `Apache` makes it easy to shoot ourselves in the foot with this, as the `PHP` module loves to execute anything ending in `PHP`. Configuring `Nginx` to use PHP is nowhere near as simple.
#### Create a Directory to Handle Uploaded Files
```shell-session
$ sudo mkdir -p /var/www/uploads/SecretUploadDirectory
```
#### Change the Owner to www-data
```shell-session
$ sudo chown -R www-data:www-data /var/www/uploads/SecretUploadDirectory
```
#### Create Nginx Configuration File
Create the Nginx configuration file by creating the file `/etc/nginx/sites-available/upload.conf` with the contents:
```shell-session
server {
    listen 9001;
    
    location /SecretUploadDirectory/ {
        root    /var/www/uploads;
        dav_methods PUT;
    }
}
```
#### Symlink our Site to the sites-enabled Directory
```shell-session
$ sudo ln -s /etc/nginx/sites-available/upload.conf /etc/nginx/sites-enabled/
```
#### Start Nginx
```shell-session
$ sudo systemctl restart nginx.service
```
If we get any error messages, check `/var/log/nginx/error.log`. If using Pwnbox, we will see port 80 is already in use.
#### Verifying Errors
```shell-session
$ tail -2 /var/log/nginx/error.log
```
```shell-session
$ ss -lnpt | grep 80
```
```shell-session
$ ps -ef | grep 2811
```
We see there is already a module listening on port 80. To get around this, we can remove the default Nginx configuration, which binds on port 80.
#### Remove NginxDefault Configuration
```shell-session
$ sudo rm /etc/nginx/sites-enabled/default
```
Now we can test uploading by using `cURL` to send a `PUT` request. In the below example, we will upload the `/etc/passwd` file to the server and call it users.txt
#### Upload File Using cURL
```shell-session
$ curl -T /etc/passwd http://localhost:9001/SecretUploadDirectory/users.txt
```
```shell-session
$ sudo tail -1 /var/www/uploads/SecretUploadDirectory/users.txt 
```
Once we have this working, a good test is to ensure the directory listing is not enabled by navigating to `http://localhost/SecretUploadDirectory`. By default, with `Apache`, if we hit a directory without an index file (index.html), it will list all the files. This is bad for our use case of exfilling files because most files are sensitive by nature, and we want to do our best to hide them. Thanks to `Nginx` being minimal, features like that are not enabled by default.