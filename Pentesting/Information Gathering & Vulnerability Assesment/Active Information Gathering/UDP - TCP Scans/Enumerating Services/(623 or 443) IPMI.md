# Intelligent Platform Management Interface (IPMI)

Intelligent Platform Management Interface (IPMI) is a set of standardized specifications for hardware-based host management systems used for system management and monitoring. It functions as an autonomous subsystem, independent of the host's BIOS, CPU, firmware, and operating system. IPMI allows sysadmins to manage and monitor systems even if they are powered off or unresponsive. It operates via a direct network connection to the system's hardware, bypassing the need for OS-level access.

## Key Uses of IPMI

IPMI is typically used in three main scenarios:
1. **Pre-OS Boot**: Modify BIOS settings before the operating system has booted.
2. **Powered Down Host**: Manage the system when it is fully powered down.
	1. **Post-System Failure**: Access a host after a system failure.

Additionally, IPMI can monitor various system metrics, such as temperature, voltage, fan status, and power supplies. It can also query inventory information, review hardware logs, and send alerts via SNMP. While the host system can be powered off, the IPMI module requires a power source and a LAN connection.

## History and Support

First published by Intel in 1998, IPMI is now supported by over 200 system vendors, including Cisco, Dell, HP, Supermicro, Intel, and more. Systems using IPMI version 2.0 can be administered via serial over LAN, allowing sysadmins to view serial console output in-band.

## Components of IPMI

To function effectively, IPMI relies on several key components:

- **Baseboard Management Controller (BMC)**: A micro-controller that is essential to IPMI.
- **Intelligent Chassis Management Bus (ICMB)**: An interface that allows communication between chassis.
- **Intelligent Platform Management Bus (IPMB)**: Extends the capabilities of the BMC.
- **IPMI Memory**: Stores system event logs, repository data, and more.
- **Communication Interfaces**: Includes local system interfaces, serial and LAN interfaces, ICMB, and PCI Management Bus.

IPMI provides a robust and versatile system management solution, ensuring sysadmins have control over their systems regardless of the system's power state or operational status.

# Footprintin

IPMI communicates over port 623 UDP. Systems using the IPMI protocol are known as Baseboard Management Controllers (BMCs). Typically implemented as embedded ARM systems running Linux, BMCs are directly connected to the host's motherboard. They are integrated into many motherboards but can also be added as a PCI card. Most servers either come with a BMC or support adding one. Common BMCs encountered during internal penetration tests include HP iLO, Dell DRAC, and Supermicro IPMI.

## Access and Capabilities

Gaining access to a BMC during an assessment provides almost complete control over the host motherboard, allowing monitoring, rebooting, powering off, or even reinstalling the host operating system. Accessing a BMC is nearly equivalent to having physical access to the system. Many BMCs, such as HP iLO, Dell DRAC, and Supermicro IPMI, expose a web-based management console, support remote access protocols like Telnet or SSH, and communicate over port 623 UDP for the IPMI network protocol.

#### Nmap

```shell-session
$ sudo nmap -sU --script ipmi-version -p 623 ilo.inlanfreight.local
```

```shell-session
msf6 > use auxiliary/scanner/ipmi/ipmi_version 
```

During internal penetration tests, we often find BMCs where the administrators have not changed the default password. Some unique default passwords to keep in our cheatsheets include:

|Product|Username|Password|
|---|---|---|
|Dell iDRAC|root|calvin|
|HP iLO|Administrator|randomized 8-character string consisting of numbers and uppercase letters|
|Supermicro IPMI|ADMIN|ADMIN|
# Dangerous Settings

## IPMI Vulnerabilities

If default credentials fail to access a BMC, we can exploit a flaw in the RAKP protocol in IPMI 2.0. During authentication, the server sends a salted SHA1 or MD5 hash of the user's password to the client before the authentication is completed. This vulnerability allows us to obtain the password hash for any valid user account on the BMC. These password hashes can be cracked offline using a dictionary attack with Hashcat mode 7300.
#### Cracking Password Hashes

For HP iLO using a factory default password, we can use the following Hashcat mask attack command:
```bash
$ hashcat -m 7300 ipmi.txt -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u
```
### Metasploit Dumping Hashes
```shell-session
msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes 
```