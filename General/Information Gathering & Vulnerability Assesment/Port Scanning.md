# Port Scanning 

--------------------------------------------------------------------

> ping **ip**

--------------------------------------------------------------------

# Port States

## State Descriptions

- **open**
  - This indicates that the connection to the scanned port has been established. These connections can be TCP connections, UDP datagrams as well as SCTP associations.

- **closed**
  - When the port is shown as closed, the TCP protocol indicates that the packet we received back contains an RST flag. This scanning method can also be used to determine if our target is alive or not.

- **filtered**
  - Nmap cannot correctly identify whether the scanned port is open or closed because either no response is returned from the target for the port or we get an error code from the target.

- **unfiltered**
  - This state of a port only occurs during the TCP-ACK scan and means that the port is accessible, but it cannot be determined whether it is open or closed.

- **open|filtered**
  - If we do not get a response for a specific port, Nmap will set it to that state. This indicates that a firewall or packet filter may protect the port.

- **closed|filtered**
  - This state only occurs in the IP ID idle scans and indicates that it was impossible to determine if the scanned port is closed or filtered by a firewall.

--------------------------------------------------------------------

# Some Scan Types

**-sS**: (nmap default) The **-sS** scan, also known as a SYN scan, is a stealthy and efficient method that sends SYN packets to determine if a port is open (SYN-ACK response) or closed (RST response) without completing the TCP handshake.

**-sT**: The **-sT** scan, or TCP connect scan, establishes a full TCP connection with the target port, making it less stealthy but reliable for determining if a port is open (successful connection) or closed (connection refused). (Three way handshake)

**-sA**: The **-sA** scan, or ACK scan, is used to map out firewall rulesets by sending ACK packets to determine if ports are filtered (no response or ICMP error) or unfiltered (RST response), without identifying open ports.

**-sU**: The **-sU** scan, or UDP scan, probes UDP ports by sending UDP packets to determine if ports are open (no response or specific service response) or closed (ICMP port unreachable message).

**-sV**: The **-sV** scan, or Version Detection scan, probes open ports to determine the version of the service running on them, providing detailed information about the software and its version.

**-sC**: The **-sC** scan, or Default Scripts scan, uses Nmap's default set of NSE scripts to perform various tasks like service detection, vulnerability detection, and more, providing additional information about the target.


--------------------------------------------------------------------
# Examples

**NMAP PORTS:**
```shell-session
$ nmap -Pn (ip)

$ nmap -Pn -sCV -0 -v ()

$ nmap -iL ips

$ nmap -iL ips -sV -0

$ nmap -T4 -PA -sC -sV -p 1-10000 0.0.0.0

$ nmap -sV -sC -p 445 0.0.0.0
```
Trace Packets:
```shell-session
$ sudo nmap 10.129.2.28 -p 21 --packet-trace -Pn -n --disable-arp-ping
```
Connect Scan:
```shell-session
$ sudo nmap 10.129.2.28 -p 443 --packet-trace --disable-arp-ping -Pn -n --reason -sT 
```
Filtered:
```shell-session
$ sudo nmap 10.129.2.28 -p 139 --packet-trace -n --disable-arp-ping -Pn
```
UDP: 
```shell-session
$ sudo nmap 10.129.2.28 -F -sU
```
```shell-session
$ sudo nmap 10.129.2.28 -sU -Pn -n --disable-arp-ping --packet-trace -p 137 --reason 
```

Version Scan:
```shell-session
$ sudo nmap 10.129.2.28 -Pn -n --disable-arp-ping --packet-trace -p 445 --reason  -sV
```

**If type3 recieved --> closed**

--------------------------------------------------------------------
# Cheatsheet

> -p- -> Scan all ports

> -p22-110 -> Scans the port range

> -p22-25 -> Scans only desired ports

> -n -> Disables DNS resolution

> -PE -> Performs the ping scan by ICMP Echo Requests

> -Pn -> Disables ICMP Echo Requests

> -F -> Scans top 100 ports

> -sU -> Performs a UDP scan

> -p 100 -> Scans only specified port

> -sV -> Service Scan

> -F -> Scans top 100 ports

> --script script

> --top-ports=num 
 
> --packet-trace -> Shows all packets sent and received

> --disable-arp-ping -> Disables ARP ping>

> --reason -> Displays the reason for specific result

> --stats-every=5s -> Shows the progress of  the scan every 5 seconds

> -O -> OS Scan

> -A -> OS Detection, Service Detection, and traceroute scans (Agressive)

> -D RND:5 -> Sets the number of random Decoys that will be used to scan the target

> -e -> Specifies the network interface that is used for the scan

> -S 10.10.10.200 -> Specifies the source IP address for the scan

> -g -> 	Specifies the source port for the scan

> --dns-server ns -> DNS resolution is performed by using a specified name server.


--------------------------------------------------------------------
# Output 
> Determined Format: -oA target.txt

> Normal Format: -oN target.nmap  

> Grepable Format : -oG target.gnmap 

> XML format: -oX target.xml

### With XML output we can create HTML reports for documentation:

```shell-session
$ xsltproc target.xml -o target.html
```

--------------------------------------------------------------------

# Performance

> --max-retries num -> Sets the number of retries for scans of specific ports

> -v/-vv -> Displays verbose output during the scan

> --initial-rtt-timeout 50ms -> Sets the specified time value as initial RTT timeout

> --max-rtt-timeout 100ms -> Sets the specified time value as maximum RTT timeout

> --min-rate 300 -> Sets the number of packets that will be sent simultaneously

> -T 0-5 -> Specifies the specific timing template

--------------------------------------------------------------------

Scripts:
```shell-session
$ sudo nmap <target> -sC
$ sudo nmap <target> --script <category>
$ sudo nmap <target> --script <script-name>,<script-name>,...
```

```shell-session
$ sudo nmap 10.129.2.28 -p 80 -sV --script vuln 
```

# Nmap Script Categories

- **auth**
  - Determination of authentication credentials.

- **broadcast**
  - Scripts used for host discovery by broadcasting. The discovered hosts can be automatically added to the remaining scans.

- **brute**
  - Executes scripts that try to log in to the respective service by brute-forcing with credentials.

- **default**
  - Default scripts executed by using the `-sC` option.

- **discovery**
  - Evaluation of accessible services.

- **dos**
  - These scripts check services for denial of service vulnerabilities and are used less as they can harm the services.

- **exploit**
  - This category of scripts tries to exploit known vulnerabilities for the scanned port.

- **external**
  - Scripts that use external services for further processing.

- **fuzzer**
  - Uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.

- **intrusive**
  - Intrusive scripts that could negatively affect the target system.

- **malware**
  - Checks if some malware infects the target system.

- **safe**
  - Defensive scripts that do not perform intrusive and destructive access.

- **version**
  - Extension for service detection.

- **vuln**
  - Identification of specific vulnerabilities.
