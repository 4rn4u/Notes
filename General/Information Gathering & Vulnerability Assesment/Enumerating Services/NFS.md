# Network File System (NFS) ports 111 / 2049

Network File System (NFS) is a network file system developed by Sun Microsystems, designed to access file systems over a network as if they were local, similar to SMB. However, NFS uses a completely different protocol and is primarily used between Linux and Unix systems, meaning NFS clients cannot directly communicate with SMB servers.

NFS is an Internet standard that dictates procedures in a distributed file system. NFS protocol version 3.0 (NFSv3), which has been in use for many years, authenticates the client computer. This changes with NFSv4, where user authentication is required, similar to the Windows SMB protocol.

## Configuration
```shell-session
$ cat /etc/exports 
```

The default exports file contains examples of configuring NFS shares. It specifies the folder to be shared, the permissions, and the hosts or subnets allowed access. Additional options can also be added for further customization.

```shell-session
$ echo '/mnt/nfs  10.129.14.0/24(sync,no_subtree_check)' >> /etc/exports
```

### Options

| Option             | Description                                                                                             |
| ------------------ | ------------------------------------------------------------------------------------------------------- |
| `rw`               | Read and write permissions.                                                                             |
| `ro`               | Read only permissions.                                                                                  |
| `sync`             | Synchronous data transfer (a bit slower).                                                               |
| `async`            | Asynchronous data transfer (a bit faster).                                                              |
| `secure`           | Ports above 1024 will not be used.                                                                      |
| `insecure`         | Ports above 1024 will be used.                                                                          |
| `no_subtree_check` | Disables the checking of subdirectory trees.                                                            |
| `root_squash`      | Assigns all permissions to files of root UID/GID 0 to the UID/GID of anonymous, preventing root access. |
### Dangerous NFS Settings

Even with NFS, some settings can pose risks to the company and its infrastructure. Here are some potentially dangerous options:

### Dangerous Options

| Option            | Description                                                                                              |
|-------------------|----------------------------------------------------------------------------------------------------------|
| `rw`              | Read and write permissions.                                                                              |
| `insecure`        | Ports above 1024 will be used.                                                                           |
| `nohide`          | If another file system is mounted below an exported directory, this directory is exported by its own exports entry. |
| `no_root_squash`  | All files created by root retain the UID/GID 0, granting root-level access.                              |

## Footprinting the Service

```shell-session
$ sudo nmap 10.129.14.128 -p111,2049 -sV -sC
```

```shell-session
$ sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049
```