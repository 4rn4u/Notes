# Internet Message Access Protocol (IMAP) Port 110/143/993/995

The Internet Message Access Protocol (IMAP) allows access to emails from a mail server. Unlike the Post Office Protocol (POP3), IMAP enables online management of emails directly on the server and supports folder structures. IMAP is a client-server-based network protocol, providing synchronization of a local email client with the server mailbox, acting as a network file system for emails, and allowing seamless synchronization across multiple independent clients.

## Key Features of IMAP

- **Online Email Management**: IMAP allows users to manage emails online directly on the server, supporting hierarchical mailbox structures and access to multiple mailboxes during a session.
- **Synchronization**: Clients can synchronize with the server, creating a uniform database across multiple clients. Emails remain on the server until deleted.
- **Simultaneous Access**: Multiple users can access the email server simultaneously. While managing emails without an active connection is impossible, some clients offer an offline mode that syncs changes once reconnected.

## Communication and Security

- **Connection and Authentication**: IMAP clients connect to the server via port 143, using text-based ASCII commands. Users authenticate with a username and password immediately after connection establishment.
- **Unencrypted Transmission**: By default, IMAP transmits commands, emails, and credentials in plain text. To enhance security and prevent unauthorized access, many email servers require encrypted IMAP sessions using SSL/TLS. The encrypted connection typically uses standard port 143 or an alternative port, such as 993.

## Comparison with POP3

- **IMAP**: Allows comprehensive email management, including creating and managing personal folders and structures on the server. Provides access to all sent emails by copying them into an IMAP folder, regardless of the sending device. This functionality increases storage space requirements on the server.
- **POP3**: Offers limited functionality, only allowing listing, retrieving, and deleting emails from the server. Does not support the advanced features of IMAP, such as hierarchical mailboxes and simultaneous access from multiple clients.

SMTP is typically used for sending emails. By copying sent emails into an IMAP folder, all clients can access sent mails, regardless of the computer from which they were sent. This approach provides a centralized and organized email management system.

# Footprinting
By default, ports `110`, `143`, `993`, and `995` are used for IMAP and POP3. The two higher ports use `TLS/SSL` to encrypt the communication between client and server. Using Nmap, we can scan the server for these ports. The scan will return the corresponding information like what we see below if the server uses an embedded SSL certificate.
#### Nmap
```shell-session
$ sudo nmap 10.129.14.128 -sV -p110,143,993,995 -sC
```
#### cURL
```shell-session
$ curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd
```
```shell-session
$ curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v
```
#### OpenSSL - TLS Encrypted Interaction POP3
```shell-session
$ openssl s_client -connect 10.129.14.128:pop3s
```
#### OpenSSL - TLS Encrypted Interaction IMAP
```shell-session
openssl s_client -connect 10.129.14.128:imaps
```

#### IMAP Commands

| **Command**                     | **Description**                                                                                               |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| `1 LOGIN username password`     | User's login.                                                                                                 |
| `1 LIST "" *`                   | Lists all directories.                                                                                        |
| `1 CREATE "INBOX"`              | Creates a mailbox with a specified name.                                                                      |
| `1 DELETE "INBOX"`              | Deletes a mailbox.                                                                                            |
| `1 RENAME "ToRead" "Important"` | Renames a mailbox.                                                                                            |
| `1 LSUB "" *`                   | Returns a subset of names from the set of names that the User has declared as being `active` or `subscribed`. |
| `1 SELECT INBOX`                | Selects a mailbox so that messages in the mailbox can be accessed.                                            |
| `1 UNSELECT INBOX`              | Exits the selected mailbox.                                                                                   |
| `1 FETCH <ID> all`              | Retrieves data associated with a message in the mailbox.                                                      |
| `1 CLOSE`                       | Removes all messages with the `Deleted` flag set.                                                             |
| `1 LOGOUT`                      | Closes the connection with the IMAP server.                                                                   |
| 1 FETCH 1 BODY.PEEK[]           |                                                                                                               |

#### POP3 Commands

|**Command**|**Description**|
|---|---|
|`USER username`|Identifies the user.|
|`PASS password`|Authentication of the user using its password.|
|`STAT`|Requests the number of saved emails from the server.|
|`LIST`|Requests from the server the number and size of all emails.|
|`RETR id`|Requests the server to deliver the requested email by ID.|
|`DELE id`|Requests the server to delete the requested email by ID.|
|`CAPA`|Requests the server to display the server capabilities.|
|`RSET`|Requests the server to reset the transmitted information.|
|`QUIT`|Closes the connection with the POP3 server.|