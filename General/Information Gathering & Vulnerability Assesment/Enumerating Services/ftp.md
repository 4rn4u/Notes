# **FTP**

## **File Transfer Protocol 21**


--------------------------------------------------------------------
#### FTP Bounce Attack
The `Nmap` -b flag can be used to perform an FTP bounce attack:
```shell-session
$ nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2
```
#### Download a File:
```shell-session
$ get Important\ Notes.txt
```

#### Download All Available Files
```shell-session
 $ wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136
```

#### Upload a File:
```shell-session
put testupload.txt 
```

--------------------------------------------------------------------
### Some Nmap Scans

```shell-session
$ sudo nmap -sV -p21 -sC -A 10.129.14.136 --script-trace
```

--------------------------------------------------------------------
### Interaction:

```shell-session
nc -nv 10.129.14.136 21
```
```shell-session
telnet 10.129.14.136 21
```

It looks slightly different if the FTP server runs with TLS/SSL encryption. Because then we need a client that can handle TLS/SSL. For this, we can use the client `openssl` and communicate with the FTP server. The good thing about using `openssl` is that we can see the SSL certificate, which can also be helpful.

```shell-session
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```

--------------------------------------------------------------------
### Nmap Scripts

```shell-session
$ sudo nmap --script-updatedb
```

```
$ nmap 0.0.0.0 —script ftp-brute —script-args userdb=/root/users -p 21

$ nmap 0.0.0.0 —script ftp-anon

$ ls -la /usr/share/nmap/scripts/ | grep ftp-*
$ find / -type f -name ftp* 2>/dev/null | grep scripts
```

--------------------------------------------------------------------
### BRUTEFORCE

```
$ hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit/data/wordlists/unix_passwords ftp
```

--------------------------------------------------------------------
### Trying anonymous login

```
$ ftp 0.0.0.0
> anonymous and “” (enter)
```
```
> **ProFTP metasploit module** for analysing ftp
> search proftp
```

--------------------------------------------------------------------
### vsFTP

```shell-session
ftp> status
ftp> debug
ftp> trace
ftp> ls
```

```shell-session
$ sudo apt install vsftpd 
```
```shell-session
$ cat /etc/vsftpd.conf | grep -v "#"
```
Deny Certain Users:
```shell-session
$ cat /etc/ftpusers

guest
john
kevin
```
#### VSFTPD Configuration Settings

| Setting                                                       | Description                                                               |
| ------------------------------------------------------------- | ------------------------------------------------------------------------- |
| `listen=NO`                                                   | Run from inetd or as a standalone daemon?                                 |
| `listen_ipv6=YES`                                             | Listen on IPv6?                                                           |
| `anonymous_enable=NO`                                         | Enable Anonymous access?                                                  |
| `local_enable=YES`                                            | Allow local users to login?                                               |
| `dirmessage_enable=YES`                                       | Display active directory messages when users go into certain directories? |
| `use_localtime=YES`                                           | Use local time?                                                           |
| `xferlog_enable=YES`                                          | Activate logging of uploads/downloads?                                    |
| `connect_from_port_20=YES`                                    | Connect from port 20?                                                     |
| `secure_chroot_dir=/var/run/vsftpd/empty`                     | Name of an empty directory for chrooting                                  |
| `pam_service_name=vsftpd`                                     | Name of the PAM service vsftpd will use                                   |
| `rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem`          | Location of the RSA certificate for SSL encrypted connections             |
| `rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key` | Location of the RSA private key for SSL encrypted connections             |
| `ssl_enable=NO`                                               | Enable SSL?                                                               |

#### Anonymous Configurations:

| Setting                        | Description                                                                    |
| ------------------------------ | ------------------------------------------------------------------------------ |
| `anonymous_enable=YES`         | Allow anonymous login?                                                         |
| `anon_upload_enable=YES`       | Allow anonymous users to upload files?                                         |
| `anon_mkdir_write_enable=YES`  | Allow anonymous users to create new directories?                               |
| `no_anon_password=YES`         | Do not ask anonymous users for a password?                                     |
| `anon_root=/home/username/ftp` | Directory for anonymous users                                                  |
| `write_enable=YES`             | Allow usage of FTP commands: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE, and SITE? |
|                                |                                                                                |

#### VSFTPD Additional Configuration Settings

| Setting                        | Description |
|--------------------------------|-------------|
| `dirmessage_enable=YES`        | Show a message when users first enter a new directory? |
| `chown_uploads=YES`            | Change ownership of anonymously uploaded files? |
| `chown_username=username`      | User who is given ownership of anonymously uploaded files. |
| `local_enable=YES`             | Enable local users to login? |
| `chroot_local_user=YES`        | Place local users into their home directory? |
| `chroot_list_enable=YES`       | Use a list of local users that will be placed in their home directory? |
| `hide_ids=YES`                 | Display all user and group information in directory listings as "ftp". |
| `ls_recurse_enable=YES`        | Allow the use of recursive listings. |
If **hide_ids** is setted to "YES" we won't see de UID and GUID representation and it will be overwritten by tcp.

If ls_recurse_enable = "Yes" we can $ ls -R and list every directory

--------------------------------------------------------------------
# TFTP

Trivial File Transfer Protocol (TFTP) is a simpler alternative to FTP, designed for file transfers between client and server processes. Unlike FTP, TFTP does not provide user authentication or many other features. TFTP uses UDP instead of TCP, making it less reliable and necessitating UDP-assisted application layer recovery.

TFTP does not require user authentication, meaning it does not support password-protected logins. Access is determined solely by the file's read and write permissions within the operating system. Consequently, TFTP operates exclusively in directories and with files that are globally readable and writable. Due to its lack of security, TFTP is typically used only in local and protected networks.

## TFTP Commands

| Command  | Description |
|----------|-------------|
| connect  | Sets the remote host, and optionally the port, for file transfers. |
| get      | Transfers a file or set of files from the remote host to the local host. |
| put      | Transfers a file or set of files from the local host to the remote host. |
| quit     | Exits TFTP. |
| status   | Shows the current status of TFTP, including the current transfer mode (ascii or binary), connection status, timeout value, and more. |
| verbose  | Toggles verbose mode, displaying additional information during file transfer. |

Unlike the FTP client, TFTP does not provide directory listing functionality.