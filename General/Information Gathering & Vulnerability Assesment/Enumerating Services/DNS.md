# Domain Name System (DNS)

The Domain Name System (DNS) is a crucial component of the Internet, translating domain names like academy.hackthebox.com or www.hackthebox.com into IP addresses. This system, which lacks a central database, functions like a library with numerous phone books, distributing information across thousands of name servers. Globally distributed DNS servers map domain names to IP addresses, determining which server a user can reach via a particular domain. There are several types of DNS servers used worldwide:

## Types of DNS Servers

### DNS Root Server
DNS root servers handle the top-level domains (TLDs) and act as a central interface between users and content on the Internet. They are requested only if other name servers do not respond. The Internet Corporation for Assigned Names and Numbers (ICANN) coordinates the work of the 13 root servers globally.
### Authoritative Name Server
Authoritative name servers have authority over specific zones and provide binding responses to queries within their responsibility. If they cannot answer a query, the root name server takes over.
### Non-authoritative Name Server
Non-authoritative name servers are not responsible for any particular DNS zone. Instead, they gather information on specific DNS zones through recursive or iterative DNS queries.
### Caching DNS Server
Caching DNS servers store information from other name servers for a specified period, determined by the authoritative name server.
### Forwarding Server
Forwarding servers solely forward DNS queries to another DNS server.
### Resolver
Resolvers are local components in a computer or router that perform name resolution but are not authoritative DNS servers.

DNS is typically unencrypted, allowing devices on local networks and Internet providers to intercept and spy on DNS queries, posing a privacy risk. To address this, solutions for DNS encryption have been developed. IT security professionals commonly use DNS over TLS (DoT) or DNS over HTTPS (DoH). Additionally, the DNSCrypt protocol encrypts the traffic between the computer and the name server. Beyond mapping computer names to IP addresses, DNS also stores and provides additional information about services associated with a domain. For example, a DNS query can reveal which computer serves as the domain's email server or the names of the domain's name servers.

# DNS Records and Their Functions

Different DNS records are used for various DNS queries, each serving distinct purposes. These records are essential for setting up services like mail servers and other servers for a domain.

## DNS Records

| DNS Record | Description |
|------------|-------------|
| **A**      | Returns an IPv4 address for the requested domain. |
| **AAAA**   | Returns an IPv6 address for the requested domain. |
| **MX**     | Returns the responsible mail servers for the domain. |
| **NS**     | Returns the DNS servers (nameservers) for the domain. |
| **TXT**    | Can contain various information, such as validating the Google Search Console or SSL certificates. It also includes SPF and DMARC entries for validating and protecting mail traffic from spam. |
| **CNAME**  | Serves as an alias. For example, if www.hackthebox.eu should point to the same IP as another domain, an A record is created for one, and a CNAME record for the other. |
| **PTR**    | Performs reverse lookups, converting IP addresses into valid domain names. |
| **SOA**    | Provides information about the DNS zone and the email address of the administrative contact. Located in a domain's zone file, it specifies who is responsible for the domain's operation and how its DNS information is managed. |

# DNS Tools Overview

| Tool                   | Key Features                                                                                          | Use Cases                                                                                                    |
|------------------------|-------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| **dig**                | Versatile DNS lookup tool supporting various query types (A, MX, NS, TXT, etc.) with detailed output.  | Manual DNS queries, zone transfers (if allowed), troubleshooting DNS issues, and in-depth DNS record analysis. |
| **nslookup**           | Simplified DNS lookup tool, primarily focused on A, AAAA, and MX records.                              | Basic DNS queries, quick domain resolution checks, and mail server record verification.                      |
| **host**               | Streamlined DNS lookup tool with concise output.                                                       | Quick checks of A, AAAA, and MX records.                                                                     |
| **dnsenum**            | Automated DNS enumeration tool that supports dictionary attacks, brute-forcing, and zone transfers.    | Efficient subdomain discovery and DNS information gathering.                                                 |
| **fierce**             | DNS reconnaissance and subdomain enumeration tool with recursive search and wildcard detection.        | User-friendly DNS reconnaissance, identifying subdomains, and potential targets.                             |
| **dnsrecon**           | Combines multiple DNS reconnaissance techniques with support for various output formats.               | Comprehensive DNS enumeration, subdomain identification, and detailed DNS record gathering.                  |
| **theHarvester**       | OSINT tool that collects information from various sources, including DNS records (email addresses).    | Gathering email addresses, employee information, and domain-related data from multiple sources.              |
| **Online DNS Lookup Services** | User-friendly interfaces for performing DNS lookups.                                              | Quick DNS lookups, useful when command-line tools aren't available, and for checking domain availability or basic information. |

# Footprinting

# Common `dig` Commands

| Command                        | Description                                                                                                       |
|--------------------------------|-------------------------------------------------------------------------------------------------------------------|
| `dig domain.com`               | Performs a default A record lookup for the domain.                                                                |
| `dig domain.com A`             | Retrieves the IPv4 address (A record) associated with the domain.                                                 |
| `dig domain.com AAAA`          | Retrieves the IPv6 address (AAAA record) associated with the domain.                                              |
| `dig domain.com MX`            | Finds the mail servers (MX records) responsible for the domain.                                                   |
| `dig domain.com NS`            | Identifies the authoritative name servers for the domain.                                                         |
| `dig domain.com TXT`           | Retrieves any TXT records associated with the domain.                                                             |
| `dig domain.com CNAME`         | Retrieves the canonical name (CNAME) record for the domain.                                                       |
| `dig domain.com SOA`           | Retrieves the start of authority (SOA) record for the domain.                                                     |
| `dig @1.1.1.1 domain.com`      | Specifies a specific name server to query; in this case, 1.1.1.1.                                                  |
| `dig +trace domain.com`        | Shows the full path of DNS resolution.                                                                            |
| `dig -x 192.168.1.1`           | Performs a reverse lookup on the IP address 192.168.1.1 to find the associated host name.                          |
| `dig +short domain.com`        | Provides a short, concise answer to the query.                                                                    |
| `dig +noall +answer domain.com`| Displays only the answer section of the query output.                                                             |
| `dig domain.com ANY`           | Retrieves all available DNS records for the domain (Note: Many DNS servers ignore ANY queries to reduce load and prevent abuse, as per RFC 8482). |


```shell-session
$ dig ns inlanefreight.htb @10.129.14.128
```

Sometimes it is also possible to query a DNS server's version using a class CHAOS query and type TXT. However, this entry must exist on the DNS server. For this, we could use the following command:
```shell-session
$ dig CH TXT version.bind 10.129.120.85
```

#### Dig - Any Query:
```shell-session
$ dig any inlanefreight.htb @10.129.14.128
```

#### DIG - AXFR Zone Transfer
```shell-session
$ dig axfr inlanefreight.htb @10.129.14.128
```

#### DIG - AXFR Zone Transfer - Internal
```shell-session
$ dig axfr internal.inlanefreight.htb @10.129.14.128
```

#### Subdomain Brute Forcing
```shell-session
$ for sub in $(cat /opt/useful/SecLists/Discovery/DNS/subdomains-top1million-110000.txt);do dig $sub.inlanefreight.htb @10.129.14.128 | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done
```

```shell-session
$ dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/SecLists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb
```